<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 14 (filtered)">
<style>
<!--
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:black;}
h1
	{margin-top:20.0pt;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h1.CxSpFirst
	{margin-top:20.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h1.CxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h1.CxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:20.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h2
	{margin-top:.25in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h2.CxSpFirst
	{margin-top:.25in;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h2.CxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h2.CxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:16.0pt;
	font-family:"Arial","sans-serif";
	color:black;
	font-weight:normal;}
h3
	{margin-top:16.0pt;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Arial","sans-serif";
	color:#434343;
	font-weight:normal;}
h3.CxSpFirst
	{margin-top:16.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Arial","sans-serif";
	color:#434343;
	font-weight:normal;}
h3.CxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Arial","sans-serif";
	color:#434343;
	font-weight:normal;}
h3.CxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Arial","sans-serif";
	color:#434343;
	font-weight:normal;}
h4
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h4.CxSpFirst
	{margin-top:14.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h4.CxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h4.CxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:12.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h5
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h5.CxSpFirst
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h5.CxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h5.CxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;}
h6
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;
	font-style:italic;}
h6.CxSpFirst
	{margin-top:12.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;
	font-style:italic;}
h6.CxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;
	font-style:italic;}
h6.CxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:4.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:11.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;
	font-weight:normal;
	font-style:italic;}
p.MsoTitle, li.MsoTitle, div.MsoTitle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:26.0pt;
	font-family:"Arial","sans-serif";
	color:black;}
p.MsoTitleCxSpFirst, li.MsoTitleCxSpFirst, div.MsoTitleCxSpFirst
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:26.0pt;
	font-family:"Arial","sans-serif";
	color:black;}
p.MsoTitleCxSpMiddle, li.MsoTitleCxSpMiddle, div.MsoTitleCxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:26.0pt;
	font-family:"Arial","sans-serif";
	color:black;}
p.MsoTitleCxSpLast, li.MsoTitleCxSpLast, div.MsoTitleCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:3.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:26.0pt;
	font-family:"Arial","sans-serif";
	color:black;}
p.MsoSubtitle, li.MsoSubtitle, div.MsoSubtitle
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:16.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:15.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;}
p.MsoSubtitleCxSpFirst, li.MsoSubtitleCxSpFirst, div.MsoSubtitleCxSpFirst
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:15.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;}
p.MsoSubtitleCxSpMiddle, li.MsoSubtitleCxSpMiddle, div.MsoSubtitleCxSpMiddle
	{margin:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:15.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;}
p.MsoSubtitleCxSpLast, li.MsoSubtitleCxSpLast, div.MsoSubtitleCxSpLast
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:16.0pt;
	margin-left:0in;
	line-height:115%;
	page-break-after:avoid;
	font-size:15.0pt;
	font-family:"Arial","sans-serif";
	color:#666666;}
.MsoChpDefault
	{color:black;}
.MsoPapDefault
	{line-height:115%;}
 /* Page Definitions */
 @page WordSection1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.WordSection1
	{page:WordSection1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body bgcolor=white lang=EN-US>

<div class=WordSection1>

<p class=MsoTitle align=center style='text-align:center'><a name="_e78id4rvny1k"></a><span
style='font-size:18.0pt;line-height:115%'>Introduction into VTI ROUTER
APPLIANCE</span> </p>

<p class=MsoNormal align=center style='text-align:center'><span
style='font-size:18.0pt;line-height:115%'>Table of Content</span></p>

<p class=MsoNormal style='margin-top:4.0pt;line-height:normal'><a
href="#_dqduh6b3rq1"><span style='color:#1155CC'>Disclaimer and CopyRights</span></a></p>

<p class=MsoNormal style='margin-top:10.0pt;line-height:normal'><a
href="#_fvsg9lcsue76"><span style='color:#1155CC'>Introduction</span></a></p>

<p class=MsoNormal style='margin-top:10.0pt;line-height:normal'><a
href="#_vgz6sjgojc3y"><span style='color:#1155CC'>Appliance Use Case</span></a></p>

<p class=MsoNormal style='margin-top:10.0pt;line-height:normal'><a
href="#_fh21i2t4j2v6"><span style='color:#1155CC'>Appliance usage in example.</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:0in;
margin-left:.25in;margin-bottom:.0001pt;line-height:normal'><a
href="#_w0hmu6iqx1pl"><span style='color:#1155CC'>Router initial setup.</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:0in;
margin-left:.25in;margin-bottom:.0001pt;line-height:normal'><a
href="#_ltsaephwqrnh"><span style='color:#1155CC'>VPN Configuration.</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:normal'><a
href="#_1ssy7l6lh093"><span style='color:#1155CC'>Create VPN on AWS and
Download.</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:normal'><a
href="#_ybs6asdcxlse"><span style='color:#1155CC'>Parse VPN description file
and apply (add and enable)</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:0in;
margin-left:.5in;margin-bottom:.0001pt;line-height:normal'><a
href="#_fiad1nml78vl"><span style='color:#1155CC'>Notice about your firewall
and traffic between this DMZ and AWS.</span></a></p>

<p class=MsoNormal style='margin-top:10.0pt;line-height:normal'><a
href="#_sfih8y3dapy9"><span style='color:#1155CC'>ATTACHMENT. Screenshots.</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:0in;
margin-left:.75in;margin-bottom:.0001pt;line-height:normal'><a
href="#_w0yru940jdo6"><span style='color:#1155CC'>Screen 1. Initial setup.</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:0in;
margin-left:.75in;margin-bottom:.0001pt;line-height:normal'><a
href="#_weyaokrstygf"><span style='color:#1155CC'>Screen 2. Initial setup
execution log (obfuscated):<br>
Screen 3. Example of AWS VPN configuration.</span></a></p>

<p class=MsoNormal style='margin-top:3.0pt;margin-right:0in;margin-bottom:4.0pt;
margin-left:.75in;line-height:normal'><a href="#_awejrd7suaee"><span
style='color:#1155CC'>Screen 4 - execution if  VTI -add vti1 vti2 command.</span></a></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<h1 align=center style='text-align:center'><a name="_dqduh6b3rq1"></a>Disclaimer</h1>

<p class=MsoNormal>VTI appliance created in EIS Group and published into public
domain under GPL licence.</p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'>#####################################################</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'># (c) EIS
Group LTD, 2016 (scripts and setup)          #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'># (License)
GPL                                 #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'># Donated to
OpenSource by EIS Group, 2016.     #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'># Authors:
Alexei Roudnev , Andrey Saveliev     #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'>#                                            
  #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'>#      open-source@eisgroup.com             
   #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'>#  or  
aprudnev@gmail.com                      #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'>#  URL;
http://eisgroup.com                     #</span></b></p>

<p class=MsoNormal align=center style='text-align:center'><b><span
style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'>#####################################################</span></b></p>

<p class=MsoNormal>This software is based on OpenSource Linux software and is
provided ‘As Is’, no guarantees.</p>

<p class=MsoNormal>(This document source:
https://docs.google.com/document/d/1E55SmAjCtrJE7UWIcjIlGdVPF3O_mBhbfDZz1y7jmJE/edit?usp=sharing)</p>

<h1 align=center style='text-align:center'><a name="_fvsg9lcsue76"></a>Introduction</h1>

<p class=MsoNormal>This system provides site-to-site IPSEC VPN  services,
compatible with public cloud providers (such as AwS or Azure, where AwS is for
Amazon cloud services, and Azure is for Microsoft cloud services). It is
Open-Source and can run as a virtual appliance (in VMware or other
virtualization systems).</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Problem is common:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Your
company decided to utilize AWS for some project, and this project need
site-to-site VPN with your network, and possible with your client’s network as well.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>AWS
supports very flexible, new IPSEC model which is called VTI - Virtual Tunnel
Interface (it uses IPSEC packets, but looks as normal interface inside the
router or firewall, so allowing normal routing (via BGP or static or other
protocols) and access control;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Most
companies got 2 problems with this:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Their
firewalls can be incompatible, as most firewalls do not support VTI at all. </p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Even
if they have compatible hardware, it usually is designed to provide INTRANET
access or to provide policy based IPSEC, and you do not want to bring AWS
network (AWS call it VPC - Virtual Private Cloud) into your INTRANET.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Company
need a method to integrate some of DMZ zones, dedicated for the project, with
AWS VPC, created in Amazon.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In
some cases, we want to interconnect some other networks, and it can not be done
on existing hardware. </p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Our solution is simple:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>We
create Virtual Appliance - virtual system, based on CentOS7 Linux, with updated
kernel, specially installed and well tested software, and a lot of management scripts.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>This
appliance can be installed, as a Virtual Server on VMware (or onto any centos
linux), into any sandbox DMZ, integrated with internal routing, and establish
VPN connections with Amazon or other such appliance;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>It
is free, so two appliances can be installed if required for redundancy;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Appliance
has tools to generate VPN for AWS automatically, from generic configuration
file, provided by Amazon; manual mode is supported as well (just enter data
manually).</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Supported protocols and features:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>IPSEC
in VTI mode, compatible with AWS (and possible, with Azure);</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Interruption-less
adding/deleting VTI tunnels;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>BGP
routing for internal and external connections (like AWS); OSPF routing; static
routing;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>SNMP
monitoring; Zabbix and other monitors can be added as required.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Optional
support (not included) for VRRP and Zabbix agent.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>System components:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Standard
CentOS7.2 (or higher)</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Kernel
4 (as default kernel has a serious bugs)</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Strongswan
for IPSEC and VTI implementation</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Quagga
for the routing implementation</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>IPTABLES
for firewall protection</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>SNMPD
for snmp monitoring</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Scripts,
which can be split into 3 groups”</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>SETUP
scripts to setup or reset system (they allow to set up VTI router on plain
CentOS7 as well, not just use this appliance)</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Parsing
and tunnel creation scripts to create tunnels out fo AWS data or manually</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Management
scripts to enable,disable, add, delete, check status, and make healthcheck, on
the tunnels.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>This
can be used as pre-configured appliance, OR can be used to add all these
features to existing CentOS7 Linux (not tested).</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Requirements:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Direct
connection to OUTSIDE network (can be replaced by properly configured NAT
translation, but it was never tested), </p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Connection
to DMZ or other network you want to integrate with AWS networks;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>VMware
ESXi 5 or higher (if you import appliance) or compatible; it can work on other
VM systems but ovf file _may_ need to be adjusted; OR Linux CentOS 7 with
packets installed as mentioned in scripts, access to DMZ and to OUTSIDE
network, 1 -2 GB of RAM, 2 or more CPU (HW solution was not tested, but we do
not see any reason, why it should not work).</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Appliance performance - it provides about 400Mbit IPSEC
bandwidth when running as a Virtual Server on average speed VMWare ESXi host;
performance can be much higher on faster hosts.</p>

<p class=MsoNormal>&nbsp;</p>

<h1 align=center style='text-align:center'><a name="_vgz6sjgojc3y"></a>Appliance
Use Case</h1>

<p class=MsoNormal>This is common use case (but it is not the only one). We
have AWS project, and must integrate AWS VPC (Virtual Private Network) into our
network and provide a flexible way to make development in our own network and
on AWS.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>1)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Create SandBOX
DMZ for the project; set up firewall rules. For example, 10.23.23.0/24</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>2)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Create AWS VPC
and network; for example, 10.20.23.0/24</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>3)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Install 1 or 2
VTI appliances into our SandBOX DMZ, with 1 interface in this DMZ and 1
interface in OUTSIDE network (maybe it can be done by reusing interface and
configuring pass thru for IPSEC on firewall, but it decrease performance and
was not tested). Integrate them with internal routing, if required. Assign
INSIDE and OUTSIDE IP and BGP AS number (can be private). Default routing is
via INSIDE (which in turn connected to SandBOX DMZ) so systems can not be
scanned or seen from OUTSIDE.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>4)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Add these VTI
appliances into AWS as ‘Customer Gateways’ and create VPN-s with them (each VPN
has 1 customer gateway and 2 IP for AWS gateways);</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>5)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Download VPN
descriptions from AWS, copy them into appliances, and parse using scripts;
parsing creates VTI interfaces descriptions (2 for each AWS VPN);</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>6)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Add these VTI
interfaces using scripts; enable them using scripts; check status using scripts;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>7)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Set up health
check script to run every 10 minutes (it helps to re-establish if something
went wrong);</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>8)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Check routing,
adjust quagga routing as required;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>9)<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp; </span>Enjoy.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>10)<span
style='font:7.0pt "Times New Roman"'> </span>If necessary disable VTI tunnel(s)
or remove it.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>11)<span
style='font:7.0pt "Times New Roman"'> </span>It can be repeated many times, as
number of VTI interfaces is not limited by the scripts.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<span style='font-size:11.0pt;line-height:115%;font-family:"Arial","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal align=center style='text-align:center'>Here is an
architecture of integrated (Private + Cloud) network </p>

<p class=MsoNormal align=center style='text-align:center'>Picture 1.</p>

<p class=MsoNormal><img border=0 width=625 height=427
src="00-VTIROUTERAPPLIANCEIntroduction-1_files/image001.gif"></p>

<h1 align=center style='text-align:center'><a name="_fh21i2t4j2v6"></a>Appliance
usage in example.</h1>

<p class=MsoNormal>Let’s show, how to setup VPN using our VTI appliance, for
such environment.<br>
(Notice: test was done with real IP and VPN, which was, then, disabled for
security purposes).</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>I set up, OUTSIDE of this document:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Extra
DMZ23 on our firewalls, which is 10.23.23.0/24, with access ‘Intranet -&gt;
DMZ23 OK, DMZ23 -&gt; OUTSIDE OK on http and https, DNS and NTP allowed. Few
test VM’s exists in this network. Access from this network to INTRANET is not
allowed, so I can allow 3d party users to access it, if it became essential (or
we can set up rules, proxies and so on).</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>We
made OUTSIDE network available inside our cloud (but with strict access rules,
so only network admin can access it. In some cases it may require extra
interface on hosts, in others it is just dedicated VLAN shared on the same L2
switches (but without any L3 interfaces).</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>AWS
VPC, with network 10.20.23.0/24, and one test instance running in it.
Propagation of routes is allowed.</p>

<p class=MsoNormalCxSpLast style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now
I prepare our test, to do it:</p>

<h2><a name="_w0hmu6iqx1pl"></a>Router initial setup.</h2>

<p class=MsoNormalCxSpFirst style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>I
clone router (I can import it from downloads repository, using ‘Vmware import’
feature) and name it dev2-lab23-gw02 .</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>I
assign 2 static IP to this router, one in DMZ23 and one in OUTSIDE network. IT
is important that virtual appliance can reach outside network. One option is to
allow OUTSIDE network inside the cloud. It is safe, in my case, as no any IP
exists on this network, except IP of our router, and router has devault inside
DMZ23 network and firewall providing extra protection of outside network. DMZ23
network is connected to eth0 and OUTSIDE network is connected to eth1. IP /
names assigned are: (it is just an example)<br>
  dev2-lab23-gw02     -  10.23.23.5<br>
  dev2-lab23-gw02ext - 63.2xx.2xx.38<br>
  AS number - we assign AS 65003, which is private AS (so can be used in
private connections only).</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>When
done, we start router, login as a root, (change root password as appliance comes
with known root), and then run initial configuration script:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Enter
host name. If you repeat script, it will remember settings you enter last time
for the same host, and propose to reuse them. It allows to repeat few
initializations, when you debug initialization.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Enter
domain name.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Enter
IP address for internal network (eth0), netmask and gateway. (Notice - THIS
gateway will be used for default traffic, such as update requests from router
itself);</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Enter
list of dns servers</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Enter
external IP, external netmask, external gateway (Notice: this gateway will be
used ONLY for the traffic to remote VPN access points);</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>REINSTALL
- if yes, packets (such as strongswan, quagga and so on) will be reinstalled.
Do not select it until you surem that router has access to CentOS and epel
repositories. This feature should be used, when you setup router on your own
CentOS7 , not in downloaded appliance.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>RECONFIGURE
- if selected, all IPSEC and routing configurations will be reset to initial
(almost empty) values.</p>

<p class=MsoNormal style='margin-left:1.0in'>&nbsp;</p>

<p class=MsoNormal style='margin-left:1.0in'>See Screen1 and Screen2
screenshots in attachment.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now,
restart router, and check all access (ping both default gateways, DNS setting,
access to CentOS7 yum repositories, system time and time zone, /etc/ntp.conf).
Now, once static IP is assigned, I can login via SSH, configure public key,
disable password login on sshd, and do other enhansements, which are outside of
our scope. What is important, they should be done in THIS time.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>If
necessary, configure OSPF and BGP routing between your router and the rest of
your network. We configured it so that we</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>restrict
announces from AWS by route-map and access-list</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Redistribute
them to OSPF which in turn peered with firewalls</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>I
used IBGP to redistribute routes to internal network, but it is not common
case; more commonly you will use ospf on firewalls, or static routes.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Remember,
quagga is not cisco, even if it looks as a cisco. You can manage it by <br>
vtysh<br>
sh run<br>
conf t<br>
&lt;config update&gt;<br>
^D<br>
wr mem<br>
^D<br>
But be careful, as it is not cisco and is not so well debugged and bug-free.
For example, when you add route-map and want to use it in bgp, make sure that
bgp is started and running, before adding, else it _may_ be added to other
routers only. So always double check the results. </p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>I
will skip this step and show only interaction with AWS. There is example of
configuration in /etc/quagga/quagga-config.SAMPLE directory. Here is my test
configuration:</p>

<p class=MsoNormal style='margin-left:1.0in'><br>
<b><span style='font-size:8.0pt;line-height:115%;font-family:"Courier New";
color:blue'>dev2-lab23-gw02.sjclab.exigengroup.com# sh run</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>Building
configuration...</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'>&nbsp;</p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>Current configuration:</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>interface eth0</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'> ipv6 nd suppress-ra</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>interface eth1</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'> ipv6 nd suppress-ra</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>interface lo</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>router bgp 65003</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>  network 10.23.23.0/24</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>router ospf</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'> redistribute bgp
route-map from_aws</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'> network 10.23.23.0/24
area 0.0.0.0</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>access-list from_aws
remark Announces we can accept from AWS and redistribute</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>access-list from_aws
permit 10.23.24.0/24</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>route-map from_aws
permit 10</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'> match ip address
from_aws</span></b></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>ip forwarding</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>line vty</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>!</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>end</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>wr mem</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>^D</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>&lt;ping internal
gateway here&gt;<br>
&lt;ping external gateway here&gt;</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>&lt;check time and time
zone&gt;</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'><b><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New";color:blue'>&lt;check syslog
settings&gt;</span></b></p>

<p class=MsoNormal style='margin-left:1.0in'>&nbsp;</p>

<p class=MsoNormal style='margin-left:1.0in'>&nbsp;</p>

<p class=MsoNormal style='margin-left:1.0in'>&nbsp;</p>

<p class=MsoNormal style='margin-left:.5in'>&nbsp;</p>

<p class=MsoNormalCxSpMiddle style='margin-left:1.0in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now
we are ready for the next step - describe our gateway on AWS as ‘Customer
gateway’, create VPN and download VPN description file for the parsing.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

<h2><a name="_ltsaephwqrnh"></a>VPN Configuration.</h2>

<h3><a name="_1ssy7l6lh093"></a>Create VPN on AWS and Download.</h3>

<p class=MsoNormal>First, you must describe your VTI router as ‘Customer
gateway’ in AWS. It is very simple, as not too much information required - you
enter Type, external IP address, BGP ASN (if using BGP).</p>

<p class=MsoNormal>&nbsp;</p>

<table class=a border=1 cellspacing=0 cellpadding=0 width=624 style='border-collapse:
 collapse;border:none'>
 <tr>
  <td width=87 valign=top style='width:65.5pt;border:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>ID:</span></b></p>
  </td>
  <td width=536 valign=top style='width:402.25pt;border:solid black 1.0pt;
  border-left:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>cgw-54c8114a (63.2xx.2xx.xx) | dev2-lab23-gw02</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=87 valign=top style='width:65.5pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>State:</span></b></p>
  </td>
  <td width=536 valign=top style='width:402.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>available</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=87 valign=top style='width:65.5pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>Type:</span></b></p>
  </td>
  <td width=536 valign=top style='width:402.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>ipsec.1</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=87 valign=top style='width:65.5pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>IP address:</span></b></p>
  </td>
  <td width=536 valign=top style='width:402.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>63.2xx.2xx.xx</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=87 valign=top style='width:65.5pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>BGP ASN:</span></b></p>
  </td>
  <td width=536 valign=top style='width:402.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>65003</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=87 valign=top style='width:65.5pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>VPC:</span></b></p>
  </td>
  <td width=536 valign=top style='width:402.25pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><a
  href="https://us-west-2.console.aws.amazon.com/vpc/home?region=us-west-2#vpcs:filter=vpc-2fdeae4b"><b><span
  style='font-size:9.0pt;font-family:"Courier New";color:#1155CC'>vpc-2fdeae4b
  (10.20.23.0/24) | AWS0-LAB23-VPC</span></b></a></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='margin-left:.5in'>&nbsp;</p>

<p class=MsoNormal>Second, you create VPN between VPC and thus ‘Customer
Gateway’. It looks like this:</p>

<p class=MsoNormal>&nbsp;</p>

<table class=a0 border=1 cellspacing=0 cellpadding=0 width=624
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=174 valign=top style='width:130.75pt;border:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>VPN ID:</span></b></p>
  </td>
  <td width=449 valign=top style='width:336.85pt;border:solid black 1.0pt;
  border-left:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>vpn-05e0fe17 | AWS23_dev2lab23gw02</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=174 valign=top style='width:130.75pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>State:</span></b></p>
  </td>
  <td width=449 valign=top style='width:336.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>available</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=174 valign=top style='width:130.75pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>Virtual Private Gateway:</span></b></p>
  </td>
  <td width=449 valign=top style='width:336.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><a
  href="https://us-west-2.console.aws.amazon.com/vpc/home?region=us-west-2#vgws:filter=vgw-4de33a53"><b><span
  style='font-size:9.0pt;font-family:"Courier New";color:#1155CC'>vgw-4de33a53
  | AWS0-LAB23-GW</span></b></a></p>
  </td>
 </tr>
 <tr>
  <td width=174 valign=top style='width:130.75pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>Customer Gateway:</span></b></p>
  </td>
  <td width=449 valign=top style='width:336.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><a
  href="https://us-west-2.console.aws.amazon.com/vpc/home?region=us-west-2#cgws:filter=cgw-54c8114a"><b><span
  style='font-size:9.0pt;font-family:"Courier New";color:#1155CC'>cgw-54c8114a
  (63.2xx.2xx.xx) | dev2-lab23-gw02</span></b></a></p>
  </td>
 </tr>
 <tr>
  <td width=174 valign=top style='width:130.75pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>Type:</span></b></p>
  </td>
  <td width=449 valign=top style='width:336.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>ipsec.1</span></b></p>
  </td>
 </tr>
 <tr>
  <td width=174 valign=top style='width:130.75pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>VPC:</span></b></p>
  </td>
  <td width=449 valign=top style='width:336.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><a
  href="https://us-west-2.console.aws.amazon.com/vpc/home?region=us-west-2#vpcs:filter=vpc-2fdeae4b"><b><span
  style='font-size:9.0pt;font-family:"Courier New";color:#1155CC'>vpc-2fdeae4b
  (10.20.23.0/24) | AWS0-LAB23-VPC</span></b></a></p>
  </td>
 </tr>
 <tr>
  <td width=174 valign=top style='width:130.75pt;border:solid black 1.0pt;
  border-top:none;padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>Routing:</span></b></p>
  </td>
  <td width=449 valign=top style='width:336.85pt;border-top:none;border-left:
  none;border-bottom:solid black 1.0pt;border-right:solid black 1.0pt;
  padding:.7pt .7pt .7pt .7pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:9.0pt;
  font-family:"Courier New"'>Dynamic</span></b></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>And now, you go and download VPN description in ‘Generic’
format. Copy this file into the router into ~/scripts/WORK/ and name it reasonably. 
It looks like this:</p>

<p class=MsoNormal>(Notice: ~/scripts is symlink to /usr/local/scripts):<br>
<br>
</p>

<p class=MsoNormal><span style='font-size:9.0pt;line-height:115%;font-family:
"Courier New"'>cd ~/scripts/WORK</span></p>

<p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;font-family:
"Courier New"'>cat aws23_dev2lab23gw02.txt<br>
(See Screen-3 in attachment for an example, with obfuscated PSK keys).</span></b></p>

<p class=MsoNormal>&nbsp;</p>

<h3><a name="_ybs6asdcxlse"></a>Parse VPN description file and apply (add and
enable)</h3>

<p class=MsoNormal>Now, we are ready for the final stages. You must create vti
interfaces and enable them. Interfaces have numbers, 1 - 99, and can be in one
of 3 states, from VTI system point of view:</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Available
- property file created (see files layout)</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Disabled
(vti interface created in strongswan but disabled by moving files into
.DISABLED subdirectory, so inactive);</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Enabled
(vti interface is active and try to establish packets).</p>

<p class=MsoNormal>First, verify that you do not have any vti created, as they
all must be unique. Cd into ~/scripts and run<br>
<br>
</p>

<p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;font-family:
"Courier New"'>[root@dev2-lab23-gw02 scripts]# VTI -list</span></b></p>

<p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;font-family:
"Courier New"'>Active: *</span></b></p>

<p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;font-family:
"Courier New"'>Disabled: *</span></b></p>

<p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;font-family:
"Courier New"'>Available: *</span></b></p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>So, we do not have any interfaces available yet. Available
means that property file exists in <b><span style='font-size:10.0pt;line-height:
115%;font-family:"Courier New"'>/usr/local/scripts/WORK/&lt;router-name&gt;.d/vtiNN.properties</span></b>
file.</p>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>There are 3 ways to create such file. </p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Manually,
by test editor.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Manually,
by VTI_ADD.sh script (and answering the questions). The benefit is that it can
create files for 2 routers on both sides, if you configure VTI-APPLIANCE to
VTI-APPLIANCE tunnel.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>By
automatic parsing of AWS description file. To do it, select vti numbers (in our
case, vti1 and vti2; do not use names with zeroes like vti01, they cause system
confusion) and run VTI_ADDAWS.sh script:<br>
<br>
<b><span style='font-size:9.0pt;line-height:115%;font-family:"Courier New"'>./VTI_ADDAWS.sh
WORK/aws23_dev2lab23gw02.txt vti1 vti2</span></b></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>Using directory
WORK/dev2-lab23-gw02.d - you can change it by -d &lt;dir&gt; option</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>grep:
WORK/dev2-lab23-gw02.d/*.properties: No such file or directory</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>grep:
WORK/dev2-lab23-gw02.d/*.properties: No such file or directory</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>Created
WORK/dev2-lab23-gw02.d/vti1.properties</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>Created
WORK/dev2-lab23-gw02.d/vti2.properties</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>[root@dev2-lab23-gw02 scripts]# VTI
-list</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>Active: *</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>Disabled: *</span></p>

<p class=MsoNormal style='margin-left:.5in'><span style='font-size:8.0pt;
line-height:115%;font-family:"Courier New"'>Available: vti1 vti2<br>
<br>
</span></p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>As
you can see, this command created property files for vti1 and vti2 virtual
interfaces, so they became ‘Available’ for the system. Files are in
WORK/&lt;hostname&gt;.d directory, we can inspect them and/or edit if
necessary:<br>
<br>
</p>

<table class=a1 border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>cat WORK/`hostname -s`.d/vti2.properties</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>### Generated Thu Oct 27 20:29:20 PDT 2016</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI=&quot;vti2&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_MTU=&quot;1420&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_OIP_LOCAL=&quot;63.2xx.2xx.38&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_OIP_REMOTE=&quot;52.39.14.106&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>LOCAL_GW=&quot;63.2xx.2xx.1&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_IIP_LOCAL=&quot;169.254.13.110/30&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_IIP_REMOTE=&quot;169.254.13.109/30&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_PSK=&quot;xxxx0kFNtuW0QdRD_ksToB1byxxxxxo.&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_MARK=&quot;24&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>#### OPTIONAL</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>ID=&quot;aws23_dev2lab23gw02_GW2&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>AWS_ID=&quot;vpn-05e0fe17&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_BGP_LOCAL_AS=&quot;65003&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_BGP_REMOTE_AS=&quot;7224&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_BGP_LOCAL_IP=&quot;169.254.13.110/30&quot;</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI_BGP_REMOTE_IP=&quot;169.254.13.109&quot;</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Next
step is to add vti into ipsec system by running VTI -add:<br>
<b><span style='font-size:10.0pt;line-height:115%;font-family:"Courier New"'> VTI
-add vti1 vti2<br>
(See an example of output in attachment in Screen 4).</span></b></p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>It
created vti1 and vti2 as disabled and created all required routing and bgp. You
may wish to adjust bgp and routing, for example by adding inbound filter:<br>
<br>
</p>

<table class=a2 border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[root@dev2-lab23-gw02 scripts]# VTI -list</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Active: *</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Disabled: vti1 vti2</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Available: vti1 vti2</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[root@dev2-lab23-gw02 scripts]# vtysh</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Hello, this is Quagga (version 0.99.22.4).</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Copyright 1996-2005 Kunihiro Ishiguro, et al.</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# sh run</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Building configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Current configuration:</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>interface eth0</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> ipv6 nd suppress-ra</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>interface eth1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> ipv6 nd suppress-ra</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>interface lo</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>router bgp 65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> bgp router-id 63.2xx.2xx.38</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> network 10.23.23.0/24</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> neighbor 169.254.13.21 remote-as 7224</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> neighbor 169.254.13.109 remote-as 7224</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>router ospf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> redistribute bgp route-map from_aws</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> network 10.23.23.0/24 area 0.0.0.0</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>ip route 52.25.31.90/32 63.2xx.2xx.1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>ip route 52.39.14.106/32 63.2xx.2xx.1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>access-list from_aws remark Announces we can
  accept from AWS and redistribute</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>access-list from_aws permit 10.20.23.0/24</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>!</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>route-map from_aws permit 10</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'> match ip address from_aws</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# conf t</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)#
  router bgp 65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  neighbor 169.254.13.21 route-map from_aws in</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  neighbor 169.254.13.109 route-map from_aws in</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  ^Z</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# wr mem</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Building Configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/zebra.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/ospfd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/bgpd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[OK]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# exit</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  </td>
 </tr>
</table>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>As
you can see, it created static routing for remote (AWS) gateways, added BGP
records for the peers (we added filter manually) and actually created vti
description files and scripts, but did not add VTI themselves into strongswan
configuration, so tunnels are still inactive. You can see it by running VTI
-status.</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Next,
activate VTI tunnels - run VTI -enable vti1 vti2<br>
<br>
</p>

<table class=a3 border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[root@dev2-lab23-gw02 scripts]# VTI -enable vti1
  vti2</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti1 enabled</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Reloading strongSwan IPsec configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>generating QUICK_MODE request 981536986 [ HASH SA
  No KE ID ID ]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>sending packet: from 63.2xx.2xx.38[4500] to
  52.25.31.90[4500] (460 bytes)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>received packet: from 52.25.31.90[4500] to
  63.2xx.2xx.38[4500] (444 bytes)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>parsed QUICK_MODE response 981536986 [ HASH SA No
  KE ID ID ]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>CHILD_SA vti1.aws23_dev2lab23gw02_GW1{2}
  established with SPIs cbf7ef1e_i 356d83c6_o and TS 0.0.0.0/0 === 0.0.0.0/0</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>connection 'vti1.aws23_dev2lab23gw02_GW1'
  established successfully</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti2 enabled</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Reloading strongSwan IPsec configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>generating QUICK_MODE request 1476949665 [ HASH SA
  No KE ID ID ]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>sending packet: from 63.2xx.2xx.38[4500] to
  52.39.14.106[4500] (460 bytes)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>received packet: from 52.39.14.106[4500] to
  63.2xx.2xx.38[4500] (444 bytes)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>parsed QUICK_MODE response 1476949665 [ HASH SA No
  KE ID ID ]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>CHILD_SA vti2.aws23_dev2lab23gw02_GW2{5}
  established with SPIs c9ab231b_i a63b9ad8_o and TS 0.0.0.0/0 === 0.0.0.0/0</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>connection 'vti2.aws23_dev2lab23gw02_GW2'
  established successfully</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Reloading strongSwan IPsec configuration...</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now,
check the status. VTI -status wil show long output; you can run <br>
<br>
</p>

<table class=a4 border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><b><span style='font-size:8.0pt;
  font-family:"Courier New"'>VTI -status | grep vti</span></b></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti2.aws23_dev2lab23gw02_GW2: #2, ESTABLISHED,
  IKEv1, e57a6f663d51aa9c:bf8e9bbd4c228ebb</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>  vti2.aws23_dev2lab23gw02_GW2: #4, reqid 2,
  INSTALLED, TUNNEL-in-UDP, ESP:AES_CBC-128/HMAC_SHA2_256_128/MODP_2048_256</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>  vti2.aws23_dev2lab23gw02_GW2: #5, reqid 2,
  INSTALLED, TUNNEL-in-UDP, ESP:AES_CBC-128/HMAC_SHA2_256_128/MODP_2048_256</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>  vti2.aws23_dev2lab23gw02_GW2: #7, reqid 2,
  INSTALLED, TUNNEL-in-UDP, ESP:AES_CBC-128/HMAC_SHA2_256_128/MODP_2048_256</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti1.aws23_dev2lab23gw02_GW1: #1, ESTABLISHED,
  IKEv1, b69a7eadbe4a6639:dc27788ab4f37f72</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>  vti1.aws23_dev2lab23gw02_GW1: #1, reqid 1,
  INSTALLED, TUNNEL-in-UDP, ESP:AES_CBC-128/HMAC_SHA2_256_128/MODP_2048_256</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>  vti1.aws23_dev2lab23gw02_GW1: #2, reqid 1,
  INSTALLED, TUNNEL-in-UDP, ESP:AES_CBC-128/HMAC_SHA2_256_128/MODP_2048_256</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>  vti1.aws23_dev2lab23gw02_GW1: #3, reqid 1,
  INSTALLED, TUNNEL-in-UDP, ESP:AES_CBC-128/HMAC_SHA2_256_128/MODP_2048_256</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>  vti1.aws23_dev2lab23gw02_GW1: #6, reqid 1,
  INSTALLED, TUNNEL-in-UDP, ESP:AES_CBC-128/HMAC_SHA2_256_128/MODP_2048_256</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti1:
  flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt;  mtu 1420</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti2: flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt; 
  mtu 1420</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>169.254.13.20   0.0.0.0           255.255.255.252
  U          0 0           0 vti1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>169.254.13.108  0.0.0.0           255.255.255.252
  U          0 0           0 vti2</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  </td>
 </tr>
</table>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Notice
that both tunnels are established, tunnel type is TUNNEL-in-UDP (as AWS uses
IPSEC in NAT mode which is UDP tunnel), and both VTI interfaces are up and got
IP addresses. Wait about 5 minutes, and you should see BGP connections
established and routing coming from AWS:<br>
<br>
</p>

<table class=a5 border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti1:
  flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt;  mtu 1420</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti2:
  flags=209&lt;UP,POINTOPOINT,RUNNING,NOARP&gt;  mtu 1420</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>10.20.23.0    169.254.13.21   255.255.255.0  
  UG       0 0           0 vti1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>169.254.13.20   0.0.0.0           255.255.255.252
  U          0 0           0 vti1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>169.254.13.108  0.0.0.0           255.255.255.252
  U          0 0           0 vti2</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>tcp           0      0 0.0.0.0:179              0.0.0.0:*          
   LISTEN</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>tcp           0      0 169.254.13.22:48432      169.254.13.21:179  
   ESTABLISHED</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>tcp           0      0 169.254.13.110:42948     169.254.13.109:179 
   ESTABLISHED</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>tcp6          0      0 :::179                   :::*      
            LISTEN</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  </td>
 </tr>
</table>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>You
can add other vti interfaces, disable / enable / remove existing ones (see VTI
-help).</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Now,
check that health-monitor works properly. It is running every 10 minutes and
helps to re-establish IPSEC connections if they fail somehow:<br>
<br>
</p>

<table class=a6 border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>cat /etc/crontab</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>SHELL=/bin/bash</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>PATH=/sbin:/bin:/usr/sbin:/usr/bin</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>MAILTO=root</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># For details see man 4 crontabs</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># Example of job definition:</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># .---------------- minute (0 - 59)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># |  .------------- hour (0 - 23)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># |  |  .---------- day of month (1 - 31)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># |  |  |  .------- month (1 - 12) OR
  jan,feb,mar,apr ...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># |  |  |  |  .---- day of week (0 - 6) (Sunday=0
  or 7) OR sun,mon,tue,wed,thu,fri,sat</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># |  |  |  |  |</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'># *  *  *  *  * user-name  command to be executed</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>*/10 * * * * root /etc/strongswan/restart_vti.sh
  &gt; /tmp/restart_vti.log 2&gt;&amp; 1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[root@dev2-lab23-gw02 scripts]#
  /etc/strongswan/restart_vti.sh</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti1.aws23_dev2lab23gw02_GW1 OK</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>vti2.aws23_dev2lab23gw02_GW2 OK</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  </td>
 </tr>
</table>

<p class=MsoNormalCxSpLast style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Restart
router; make sure that everything comes up after the restart (BGP re-connection
takes up to a few minutes, so be patient). Add snmp and zabbix monitoring, as
necessary. Test performance. Enjoy.</p>

<h3><a name="_fiad1nml78vl"></a>Notice about your firewall and traffic between
this DMZ and AWS.</h3>

<p class=MsoNormal>If you have servers in the same DMZ, where VTI router(s) are
configured, you _MAY_ experience unsymmetrical firewall routing, when traffic
is between the server in this DMZ and AWS. The reason is that, traffic from the
server TO AWS go usually to the firewall first, which in turn must forward it
to VTI router, Traffic from AWS go directly. It may cause a few issues.
Solutions are</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Separate
servers and VTI into 2 different DMZ (recommended!)</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Set
up default gateway on VTI routers and use OSPF to route traffic between them
and INTRANET (you may want to use VRRP for redundancy)</p>

<p class=MsoNormalCxSpMiddle style='margin-left:.5in;text-indent:-.25in'>-<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Allow
firewall to pass non-symmetrical traffic, see this article: <a
href="http://packetflow.io/2014/03/asa-hairpinning-and-tcp-state-bypass.html"><span
style='color:#1155CC'>http://packetflow.io/2014/03/asa-hairpinning-and-tcp-state-bypass.html</span></a></p>

<p class=MsoNormal style='text-indent:.5in'>Here is configuration example (for
ASA 8.2.5), it is not full as few other places are changed as well. Other
firewalls may need different setting.</p>

<table class=a7 border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>class-map dmz23_bypass<br>
   match access-list dmz23_bypass</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>policy-map dmz23_bypass_policy<br>
   class dmz23_bypass<br>
    set connection advanced-options tcp-state-bypass<br>
  !<br>
  service-policy dmz23_bypass_policy interface dmz23</span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal style='margin-left:1.0in'>&nbsp;</p>

<h1 style='margin-left:1.0in'><a name="_n4dx2lp1tciz"></a>&nbsp;</h1>

<span style='font-size:11.0pt;line-height:115%;font-family:"Arial","sans-serif"'><br
clear=all style='page-break-before:always'>
</span>

<p class=MsoNormal>&nbsp;</p>

<h1 style='margin-left:1.0in'><a name="_2krcgrbjmman"></a>&nbsp;</h1>

<h1><a name="_sfih8y3dapy9"></a>ATTACHMENT. Screenshots.</h1>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal> </p>

<h4><a name="_w0yru940jdo6"></a>Screen 1. Initial setup.</h4>

<p class=MsoNormal>&nbsp;</p>

<table class=a8 border=1 cellspacing=0 cellpadding=0 width=624
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=624 valign=top style='width:6.5in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[root@vti-router-v01 scripts]# ./INITIAL_SETUP.sh</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter short hostname</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>host= [vti-router-v01]_dev2-lab23-gw02</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter short hostname</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>host= [dev2-lab23-gw02]_</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter domain name</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>domain=
  [net.exigengroup.com]_sjclab.exigengroup.com</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter my INSIDE IP address</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>IP= []_10.23.23.5</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter netmask for 10.23.23.5</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>NETMASK= [255.255.255.0]_255.255.255.0</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter gateway for 10.23.23.5</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>GATEWAY= [10.23.23.1]_</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter list of DNS servers (IP, space delimited)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dnsservers= [10.25.168.31 10.23.5.31 192.168.8.24
  ]_10.21.5.31 10.23.5.31</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter OUTSIDE IP address</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>EXT_IP= []_63.2NN.2NN.38</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter OUTSIDE IP netmask</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>EXT_NETMASK= [255.255.255.0]_</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter OUTSIDE IP Gateway</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>EXT_GW= [63.2NN.2NN.1]_</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter LOCAL AS number, no BGP if empty</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>LOCAL_AS= []_65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Enter list of OSPF networks in N.N.N.N/prefix
  format delimited by spaces</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>OSPF_NETWORKS= []_10.23.23.0/24</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>SNMP v1/v2 communities (no SNMP if empty)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>SNMP_COMM= []_TestSnmp</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Reinstall or install software and system
  variables?</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>(require INTERNET connection)</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>REINSTALL= [n]_</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Reset IPSEC and quagga configuration files?</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>RESET= [y]_</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>*** VERIFY:</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>HOST dev2-lab23-gw02.sjclab.exigengroup.com</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>IP: 10.23.23.5</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>NETMASK: 255.255.255.0</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>GATEWAY: 10.23.23.1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>EXT_IP:  63.2NN.2NN.38</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>EXT_NETMASK: 255.255.255.0</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>EXT_GW:  63.2NN.2NN.1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>LOCAL_AS: 65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>OSPF_NETWORKS: 10.23.23.0/24</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>RESET: y</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>REINSTALL: n</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>SNMP_COMM: TestSnmp</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>^C to abort, ENTER to proceed_</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>Screen 2. Initial setup execution log (obfuscated):<br>
<img border=0 width=624 height=425 id=image01.png
src="00-VTIROUTERAPPLIANCEIntroduction-1_files/image002.jpg"><br clear=all
style='page-break-before:always'>
</p>

<h4><a name="_weyaokrstygf"></a>Screen 3. Example of AWS VPN configuration.</h4>

<p class=MsoNormal>&nbsp;</p>

<table class=a9 border=1 cellspacing=0 cellpadding=0 width=624
 style='border-collapse:collapse;border:none'>
 <tr>
  <td width=624 valign=top style='width:6.5in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal>#VPN description file example:<br>
  <b><span style='font-size:8.0pt;line-height:115%;font-family:"Courier New"'> cd
  ~/scripts/WORK ; cat aws23_dev2lab23gw02.txt</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Amazon Web Services</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Virtual Private Cloud</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>VPN Connection Configuration</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>================================================================================</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>AWS utilizes unique identifiers to manipulate the
  configuration of</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>a VPN Connection. Each VPN Connection is assigned
  a VPN Connection Identifier</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>and is associated with two other identifiers,
  namely the</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Customer Gateway Identifier and the Virtual
  Private Gateway Identifier.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Your VPN Connection ID                   :
  vpn-05e0fe17</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Your Virtual Private Gateway ID          :
  vgw-4de33a53</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Your Customer Gateway ID                 :
  cgw-54c8114a</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>A VPN Connection consists of a pair of IPSec
  tunnel security associations (SAs).</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>It is important that both tunnel security
  associations be configured.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IPSec Tunnel #1</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>================================================================================</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#1: Internet Key Exchange Configuration</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure the IKE SA as follows:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Please note, these sample configurations are for
  the minimum requirement of AES128, SHA1, and DH Group 2.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>You will need to modify these sample configuration
  files to take advantage of AES256, SHA256, or other DH groups like 2, 14-18,
  22, 23, and 24.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The address of the external interface for your
  customer gateway must be a static address.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Your customer gateway may reside behind a device
  performing network address translation (NAT).</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>To ensure that NAT traversal (NAT-T) can function,
  you must adjust your firewall !rules to unblock UDP port 4500. If not behind
  NAT, we recommend disabling NAT-T.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Authentication Method  : Pre-Shared Key</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Pre-Shared Key         :
  xxxx1DEJB2wtXzc4jYRGvADIhVLxxxxx</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Authentication Algorithm : sha1</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Encryption Algorithm   : aes-128-cbc</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Lifetime               : 28800 seconds</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Phase 1 Negotiation Mode : main</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Perfect Forward Secrecy  : Diffie-Hellman
  Group 2</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#2: IPSec Configuration</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure the IPSec SA as follows:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Please note, you may use these additionally
  supported IPSec parameters for encryption like AES256 and other DH groups
  like 1,2, 5, 14-18, 22, 23, and 24.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Protocol               : esp</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Authentication Algorithm : hmac-sha1-96</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Encryption Algorithm   : aes-128-cbc</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Lifetime               : 3600 seconds</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Mode                   : tunnel</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Perfect Forward Secrecy  : Diffie-Hellman
  Group 2</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IPSec Dead Peer Detection (DPD) will be enabled on
  the AWS Endpoint. We</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>recommend configuring DPD on your endpoint as
  follows:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - DPD Interval           : 10</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - DPD Retries            : 3</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IPSec ESP (Encapsulating Security Payload) inserts
  additional</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>headers to transmit packets. These headers require
  additional space,</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>which reduces the amount of space available to
  transmit application data.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>To limit the impact of this behavior, we recommend
  the following</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>configuration on your Customer Gateway:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - TCP MSS Adjustment     : 1387 bytes</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Clear Don't Fragment Bit : enabled</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Fragmentation          : Before encryption</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#3: Tunnel Interface Configuration</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Your Customer Gateway must be configured with a
  tunnel interface that is</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>associated with the IPSec tunnel. All traffic
  transmitted to the tunnel</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>interface is encrypted and transmitted to the
  Virtual Private Gateway.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Customer Gateway and Virtual Private Gateway
  each have two addresses that relate</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>to this IPSec tunnel. Each contains an outside
  address, upon which encrypted</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>traffic is exchanged. Each also contain an inside
  address associated with</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>the tunnel interface.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Customer Gateway outside IP address was
  provided when the Customer Gateway</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>was created. Changing the IP address requires the
  creation of a new</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Customer Gateway.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Customer Gateway inside IP address should be
  configured on your tunnel</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>interface.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Outside IP Addresses:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Customer Gateway                     :
  63.2xx.2xx.38</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Virtual Private Gateway              :
  52.25.31.90</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Inside IP Addresses</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Customer Gateway                     :
  169.254.13.22/30</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Virtual Private Gateway              :
  169.254.13.21/30</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure your tunnel to fragment at the optimal
  size:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Tunnel interface MTU   : 1436 bytes</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#4: Border Gateway Protocol (BGP) Configuration:</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Border Gateway Protocol (BGPv4) is used within
  the tunnel, between the inside</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IP addresses, to exchange routes from the VPC to
  your home network. Each</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>BGP router has an Autonomous System Number (ASN).
  Your ASN was provided</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>to AWS when the Customer Gateway was created.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>BGP Configuration Options:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Customer Gateway ASN                 : 65003</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Virtual Private  Gateway ASN         : 7224</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Neighbor IP Address                  :
  169.254.13.21</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Neighbor Hold Time     : 30</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure BGP to announce routes to the Virtual
  Private Gateway. The gateway</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>will announce prefixes to your customer gateway
  based upon the prefix you</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>assigned to the VPC at creation time.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IPSec Tunnel #2</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>================================================================================</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#1: Internet Key Exchange Configuration</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure the IKE SA as follows:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Please note, these sample configurations are for
  the minimum requirement of AES128, SHA1, and DH Group 2.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>You will need to modify these sample configuration
  files to take advantage of AES256, SHA256, or other DH groups like 2, 14-18,
  22, 23, and 24.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The address of the external interface for your
  customer gateway must be a static address.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Your customer gateway may reside behind a device
  performing network address translation (NAT).</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>To ensure that NAT traversal (NAT-T) can function,
  you must adjust your firewall !rules to unblock UDP port 4500. If not behind
  NAT, we recommend disabling NAT-T.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Authentication Method  : Pre-Shared Key</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Pre-Shared Key         :
  xxxxNG0kFNtuW0QdRD_ksToB1byJxxxx.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Authentication Algorithm : sha1</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Encryption Algorithm   : aes-128-cbc</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Lifetime               : 28800 seconds</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Phase 1 Negotiation Mode : main</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Perfect Forward Secrecy  : Diffie-Hellman
  Group 2</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#2: IPSec Configuration</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure the IPSec SA as follows:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Please note, you may use these additionally
  supported IPSec parameters for encryption like AES256 and other DH groups
  like 1,2, 5, 14-18, 22, 23, and 24.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Protocol               : esp</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Authentication Algorithm : hmac-sha1-96</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Encryption Algorithm   : aes-128-cbc</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Lifetime               : 3600 seconds</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Mode                   : tunnel</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Perfect Forward Secrecy  : Diffie-Hellman
  Group 2</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IPSec Dead Peer Detection (DPD) will be enabled on
  the AWS Endpoint. We</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>recommend configuring DPD on your endpoint as
  follows:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - DPD Interval           : 10</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - DPD Retries            : 3</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IPSec ESP (Encapsulating Security Payload) inserts
  additional</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>headers to transmit packets. These headers require
  additional space,</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>which reduces the amount of space available to
  transmit application data.</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>To limit the impact of this behavior, we recommend
  the following</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>configuration on your Customer Gateway:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - TCP MSS Adjustment     : 1387 bytes</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Clear Don't Fragment Bit : enabled</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Fragmentation          : Before encryption</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#3: Tunnel Interface Configuration</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Your Customer Gateway must be configured with a
  tunnel interface that is</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>associated with the IPSec tunnel. All traffic
  transmitted to the tunnel</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>interface is encrypted and transmitted to the
  Virtual Private Gateway.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Customer Gateway and Virtual Private Gateway
  each have two addresses that relate</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>to this IPSec tunnel. Each contains an outside
  address, upon which encrypted</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>traffic is exchanged. Each also contain an inside
  address associated with</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>the tunnel interface.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Customer Gateway outside IP address was
  provided when the Customer Gateway</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>was created. Changing the IP address requires the
  creation of a new</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Customer Gateway.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Customer Gateway inside IP address should be
  configured on your tunnel</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>interface.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Outside IP Addresses:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Customer Gateway                     :
  63.2xx.2xx.38</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Virtual Private Gateway              :
  52.39.14.106</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Inside IP Addresses</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Customer Gateway                     :
  169.254.13.110/30</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Virtual Private Gateway              :
  169.254.13.109/30</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure your tunnel to fragment at the optimal
  size:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Tunnel interface MTU   : 1436 bytes</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>#4: Border Gateway Protocol (BGP) Configuration:</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>The Border Gateway Protocol (BGPv4) is used within
  the tunnel, between the inside</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>IP addresses, to exchange routes from the VPC to
  your home network. Each</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>BGP router has an Autonomous System Number (ASN).
  Your ASN was provided</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>to AWS when the Customer Gateway was created.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>BGP Configuration Options:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Customer Gateway ASN                 : 65003</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Virtual Private  Gateway ASN         : 7224</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Neighbor IP Address                  :
  169.254.13.109</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Neighbor Hold Time     : 30</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Configure BGP to announce routes to the Virtual
  Private Gateway. The gateway</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>will announce prefixes to your customer gateway
  based upon the prefix you</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>assigned to the VPC at creation time.</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>Additional Notes and Questions</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>================================================================================</span></b></p>
  <p class=MsoNormal>&nbsp;</p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Amazon Virtual Private Cloud Getting Started
  Guide:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>       http://docs.amazonwebservices.com/AmazonVPC/latest/GettingStartedGuide</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - Amazon Virtual Private Cloud Network
  Administrator Guide:</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>       http://docs.amazonwebservices.com/AmazonVPC/latest/NetworkAdminGuide</span></b></p>
  <p class=MsoNormal><b><span style='font-size:8.0pt;line-height:115%;
  font-family:"Courier New"'>  - XSL Version: 2009-07-15-1119716</span></b></p>
  </td>
 </tr>
</table>

<h4><a name="_awejrd7suaee"></a>Screen 4 - execution if  <b>VTI -add vti1 vti2</b>
command.</h4>

<p class=MsoNormal>&nbsp;</p>

<table class=aa border=1 cellspacing=0 cellpadding=0 width=576
 style='margin-left:.5in;border-collapse:collapse;border:none'>
 <tr>
  <td width=576 valign=top style='width:6.0in;border:solid black 1.0pt;
  padding:5.0pt 5.0pt 5.0pt 5.0pt'>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>1. Creating /etc/strongswan/vti.d/vti1.init,
  vti1.secret, vti1.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>quagga: Adding ip route 52.25.31.90/32 63.2xx.2xx.1</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Hello, this is Quagga (version 0.99.22.4).</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Copyright 1996-2005 Kunihiro Ishiguro, et al.</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# conf t</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)# ip
  route 52.25.31.90/32 63.2xx.2xx.1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)#
  exit</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# write mem</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Building Configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/zebra.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/ospfd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/bgpd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[OK]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com#</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>quagga: Adding neighbor 169.254.13.21 remote-as
  7224</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Hello, this is Quagga (version 0.99.22.4).</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Copyright 1996-2005 Kunihiro Ishiguro, et al.</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# conf t</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)#
  router bgp 65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  neighbor 169.254.13.21 remote-as 7224</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  neighbor 169.254.13.21 local-as 65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>% Cannot have local-as same as BGP AS number</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  exit</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)#
  exit</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# write mem</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Building Configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/zebra.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/ospfd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/bgpd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[OK]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com#</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>***INFO: vti1 created as DISABLED, run
  /usr/local/scripts/VTI_OPS.sh -enable vti1 to activate</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>***INFO: You may wish to edit /etc/strongswan/vti.d/vti1.init
  and /etc/strongswan/vti.d/.DISABLED/vti1.conf first</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>1. Creating /etc/strongswan/vti.d/vti2.init,
  vti2.secret, vti2.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>quagga: Adding ip route 52.39.14.106/32
  63.2xx.2xx.1</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Hello, this is Quagga (version 0.99.22.4).</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Copyright 1996-2005 Kunihiro Ishiguro, et al.</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# conf t</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)# ip
  route 52.39.14.106/32 63.2xx.2xx.1</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)#
  exit</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# write mem</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Building Configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/zebra.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/ospfd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/bgpd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[OK]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com#</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>quagga: Adding neighbor 169.254.13.109 remote-as
  7224</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Hello, this is Quagga (version 0.99.22.4).</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Copyright 1996-2005 Kunihiro Ishiguro, et al.</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# conf t</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)#
  router bgp 65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  neighbor 169.254.13.109 remote-as 7224</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  neighbor 169.254.13.109 local-as 65003</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>% Cannot have local-as same as BGP AS number</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config-router)#
  exit</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com(config)#
  exit</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com# write mem</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Building Configuration...</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/zebra.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/ospfd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>Configuration saved to /etc/quagga/bgpd.conf</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[OK]</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>dev2-lab23-gw02.sjclab.exigengroup.com#</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>***INFO: vti2 created as DISABLED, run
  /usr/local/scripts/VTI_OPS.sh -enable vti2 to activate</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>***INFO: You may wish to edit
  /etc/strongswan/vti.d/vti2.init and /etc/strongswan/vti.d/.DISABLED/vti2.conf
  first</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>No changes</span></p>
  <p class=MsoNormal style='line-height:normal'><span style='font-size:8.0pt;
  font-family:"Courier New"'>[root@dev2-lab23-gw02 scripts]#</span></p>
  <p class=MsoNormal style='line-height:normal'>&nbsp;</p>
  </td>
 </tr>
</table>

<p class=MsoNormal>&nbsp;</p>

<p class=MsoNormal>&nbsp;</p>

</div>

</body>

</html>
